{% extends "base.html" %}
{% block content %}

<main class="container">
  <section class="section">
    <div class="toolbar">
      <div>
        <h1 class="h1">Account</h1>
        <div class="muted">Profile UI: delivery address, personal details, password change.</div>
      </div>
      <form action="{% url 'users:logout' %}" method="post">
        {% csrf_token %}
        <button class="btn" type="submit">Logout</button>
      </form>
    </div>

    {% if messages %}
      {% for message in messages %}
        {% if "success" in message.tags %}
          <div class="form-global-success">
            {{ message }}
            </div>
          {% endif %}
      {% endfor %}
    {% endif %}
    <div class="grid cols-2">
      <div class="card pad" id="profile">
        <h3>Personal details</h3>
        <div class="spacer"></div>

        <form class="form" method="post">
          {% csrf_token %}

          <div class="two">
            {% include "components/form_field.html" with field=profile_form.first_name %}
            {% include "components/form_field.html" with field=profile_form.last_name %}
          </div>

          <div class="two">
            {% include "components/form_field.html" with field=profile_form.email %}
            {% include "components/form_field.html" with field=profile_form.phone %}
          </div>

          <br>
          <div style="display:flex; gap:10px; flex-wrap:wrap">
            <button class="btn primary" name="profile-submit" type="submit">Save changes</button>
            <button class="btn" type="reset">Cancel</button>
          </div>
        </form>
      </div>

      <div class="card pad">
        <div class="toolbar">
          <h3 style="margin:0">My addresses</h3>
          <a class="btn primary" href="{% url 'users:address_add' %}">
            Add address
          </a>
        </div>

        {% if request.user.addresses.all %}
          <div style="display:grid;gap:14px;margin-top:14px">

            {% for address in request.user.addresses.all %}
              <div class="card pad" style="background: rgba(255,255,255,.02)">

                <div class="toolbar" style="margin-bottom:8px">
                  <div>
                    <b>{{ address.first_name }} {{ address.last_name }}</b>
                    {% if address.is_default %}
                      <span class="pill good" style="margin-left:8px">Default</span>
                    {% endif %}
                  </div>

                  <div style="display:flex;gap:8px">
                    <a class="btn" href="{% url 'users:address_edit' address.pk %}">
                      Edit
                    </a>

                    {% if not address.is_default %}
                      <a class="btn" href="{% url 'users:address_default' address.pk %}">
                        Set default
                      </a>
                    {% endif %}

                    <a class="btn" href="{% url 'users:address_delete' address.pk %}">
                      Delete
                    </a>
                  </div>
                </div>

                <div class="muted" style="line-height:1.5">
                  {{ address.street }}<br>
                  {{ address.postal_code }} {{ address.city }}{% if address.state %}, {{ address.state }}{% endif %}<br>
                  {{ address.country }}<br>
                  {{ address.phone }} • {{ address.email }}
                </div>

              </div>
            {% endfor %}

          </div>

        {% else %}
          <div class="card pad" style="margin-top:14px;text-align:center">
            <p class="muted">No addresses yet.</p>
            <a class="btn primary" href="{% url 'users:address_add' %}">
              Add your first address
            </a>
          </div>
        {% endif %}
      </div>
    </div>

    <div class="spacer"></div>

    <div class="card pad" id="security">
      <div class="toolbar" style="margin-bottom:0">
        <div>
          <h3>Security</h3>
          <div class="muted">Change password UI</div>
        </div>
        <span class="pill">2FA (UI placeholder)</span>
      </div>

      <div class="spacer"></div>

      <form class="form" action="#" method="post">
        <div class="two">
          <div class="field">
            <label for="old">Current password</label>
            <input class="input" id="old" type="password" placeholder="••••••••" />
          </div>
          <div class="field">
            <label for="new">New password</label>
            <input class="input" id="new" type="password" placeholder="Min 8 characters" />
          </div>
        </div>

        <div class="field">
          <label for="repeat">Repeat new password</label>
          <input class="input" id="repeat" type="password" placeholder="Repeat new password" />
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn primary" type="button">Update password</button>
          <button class="btn" type="button" style="border-color:rgba(255,77,109,.25)">Reset via email</button>
        </div>

        <div class="help">Use secure password rules + hashing in backend. This is UI only.</div>
      </form>
    </div>
  </section>

</main>
{% endblock %}